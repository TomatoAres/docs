
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>wx 私有化部署最佳实践 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-insert-logo/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-lightbox/css/lightbox.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="storage-practice.html" />
    
    
    <link rel="prev" href="custom-k8s-version-upgrade.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../installation/">
            
                <a href="../installation/">
            
                    
                        <b>1.2.</b>
                    
                    部署指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../installation/installation-architecture.html">
            
                <a href="../installation/installation-architecture.html">
            
                    
                        <b>1.2.1.</b>
                    
                    产品部署架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../installation/environment-requirement.html">
            
                <a href="../installation/environment-requirement.html">
            
                    
                        <b>1.2.2.</b>
                    
                    部署环境要求
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../installation/installation-steps.html">
            
                <a href="../installation/installation-steps.html">
            
                    
                        <b>1.2.3.</b>
                    
                    安装步骤
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../quick-start/">
            
                <a href="../quick-start/">
            
                    
                        <b>1.3.</b>
                    
                    快速入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../quick-start/quick-starts.html">
            
                <a href="../quick-start/quick-starts.html">
            
                    
                        <b>1.3.1.</b>
                    
                    快速入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../quick-start/example/">
            
                <a href="../quick-start/example/">
            
                    
                        <b>1.3.2.</b>
                    
                    入门示例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../quick-start/example/nginx-example.html">
            
                <a href="../quick-start/example/nginx-example.html">
            
                    
                        <b>1.3.2.1.</b>
                    
                    创建Nginx服务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../quick-start/example/helloword-example.html">
            
                <a href="../quick-start/example/helloword-example.html">
            
                    
                        <b>1.3.2.2.</b>
                    
                    编写HelloWorld程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../quick-start/example/docker-image-example.html">
            
                <a href="../quick-start/example/docker-image-example.html">
            
                    
                        <b>1.3.2.3.</b>
                    
                    如何构建Docker镜像
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../user-guide/">
            
                <a href="../user-guide/">
            
                    
                        <b>1.4.</b>
                    
                    产品使用指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../user-guide/console-switch.html">
            
                <a href="../user-guide/console-switch.html">
            
                    
                        <b>1.4.1.</b>
                    
                    切换控制台
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../user-guide/platform-console/">
            
                <a href="../user-guide/platform-console/">
            
                    
                        <b>1.4.2.</b>
                    
                    平台管理控制台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../user-guide/platform-console/overview.html">
            
                <a href="../user-guide/platform-console/overview.html">
            
                    
                        <b>1.4.2.1.</b>
                    
                    概览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../user-guide/platform-console/cluster-mgmt.html">
            
                <a href="../user-guide/platform-console/cluster-mgmt.html">
            
                    
                        <b>1.4.2.2.</b>
                    
                    集群管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="../user-guide/platform-console/business-mgmt.html">
            
                <a href="../user-guide/platform-console/business-mgmt.html">
            
                    
                        <b>1.4.2.3.</b>
                    
                    业务管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4" data-path="../user-guide/platform-console/addon-mgmt/">
            
                <a href="../user-guide/platform-console/addon-mgmt/">
            
                    
                        <b>1.4.2.4.</b>
                    
                    扩展组件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.4.1" data-path="../user-guide/platform-console/addon-mgmt/tappcontroller.html">
            
                <a href="../user-guide/platform-console/addon-mgmt/tappcontroller.html">
            
                    
                        <b>1.4.2.4.1.</b>
                    
                    TApp 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.2" data-path="../user-guide/platform-console/addon-mgmt/cronhpa.html">
            
                <a href="../user-guide/platform-console/addon-mgmt/cronhpa.html">
            
                    
                        <b>1.4.2.4.2.</b>
                    
                    CronHPA 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.3" data-path="../user-guide/platform-console/addon-mgmt/prometheus.html">
            
                <a href="../user-guide/platform-console/addon-mgmt/prometheus.html">
            
                    
                        <b>1.4.2.4.3.</b>
                    
                    监控组件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.4" data-path="../user-guide/platform-console/addon-mgmt/logagent.html">
            
                <a href="../user-guide/platform-console/addon-mgmt/logagent.html">
            
                    
                        <b>1.4.2.4.4.</b>
                    
                    LogAgent 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.5" data-path="../user-guide/platform-console/addon-mgmt/gpumanger.html">
            
                <a href="../user-guide/platform-console/addon-mgmt/gpumanger.html">
            
                    
                        <b>1.4.2.4.5.</b>
                    
                    GPUManager 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.4.6" data-path="../user-guide/platform-console/addon-mgmt/csioperator.html">
            
                <a href="../user-guide/platform-console/addon-mgmt/csioperator.html">
            
                    
                        <b>1.4.2.4.6.</b>
                    
                    CSIOperator 介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2.5" data-path="../user-guide/platform-console/registry-mgmt/">
            
                <a href="../user-guide/platform-console/registry-mgmt/">
            
                    
                        <b>1.4.2.5.</b>
                    
                    组织资源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.5.1" data-path="../user-guide/platform-console/registry-mgmt/registry.html">
            
                <a href="../user-guide/platform-console/registry-mgmt/registry.html">
            
                    
                        <b>1.4.2.5.1.</b>
                    
                    镜像仓库管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.5.2" data-path="../user-guide/platform-console/registry-mgmt/helm-repo.html">
            
                <a href="../user-guide/platform-console/registry-mgmt/helm-repo.html">
            
                    
                        <b>1.4.2.5.2.</b>
                    
                    Helm模板
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.5.3" data-path="../user-guide/platform-console/registry-mgmt/apikey.html">
            
                <a href="../user-guide/platform-console/registry-mgmt/apikey.html">
            
                    
                        <b>1.4.2.5.3.</b>
                    
                    访问凭证
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2.6" data-path="../user-guide/platform-console/access-mgmt/">
            
                <a href="../user-guide/platform-console/access-mgmt/">
            
                    
                        <b>1.4.2.6.</b>
                    
                    访问管理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.6.1" data-path="../user-guide/platform-console/access-mgmt/policy.html">
            
                <a href="../user-guide/platform-console/access-mgmt/policy.html">
            
                    
                        <b>1.4.2.6.1.</b>
                    
                    策略管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.6.2" data-path="../user-guide/platform-console/access-mgmt/user.html">
            
                <a href="../user-guide/platform-console/access-mgmt/user.html">
            
                    
                        <b>1.4.2.6.2.</b>
                    
                    用户管理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2.7" data-path="../user-guide/platform-console/monitor-alert/">
            
                <a href="../user-guide/platform-console/monitor-alert/">
            
                    
                        <b>1.4.2.7.</b>
                    
                    监控&告警
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.7.1" data-path="../user-guide/platform-console/monitor-alert/alertmetrics.html">
            
                <a href="../user-guide/platform-console/monitor-alert/alertmetrics.html">
            
                    
                        <b>1.4.2.7.1.</b>
                    
                    告警记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.7.2" data-path="../user-guide/platform-console/monitor-alert/notification.html">
            
                <a href="../user-guide/platform-console/monitor-alert/notification.html">
            
                    
                        <b>1.4.2.7.2.</b>
                    
                    通知设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.7.3" data-path="../user-guide/platform-console/monitor-alert/alertsetting.html">
            
                <a href="../user-guide/platform-console/monitor-alert/alertsetting.html">
            
                    
                        <b>1.4.2.7.3.</b>
                    
                    告警设置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2.8" data-path="../user-guide/platform-console/operation-mgmt/">
            
                <a href="../user-guide/platform-console/operation-mgmt/">
            
                    
                        <b>1.4.2.8.</b>
                    
                    运维中心
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.8.1" data-path="../user-guide/platform-console/operation-mgmt/helm.html">
            
                <a href="../user-guide/platform-console/operation-mgmt/helm.html">
            
                    
                        <b>1.4.2.8.1.</b>
                    
                    Helm应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.8.2" data-path="../user-guide/platform-console/operation-mgmt/log-collect.html">
            
                <a href="../user-guide/platform-console/operation-mgmt/log-collect.html">
            
                    
                        <b>1.4.2.8.2.</b>
                    
                    日志采集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.8.3" data-path="../user-guide/platform-console/operation-mgmt/audit.html">
            
                <a href="../user-guide/platform-console/operation-mgmt/audit.html">
            
                    
                        <b>1.4.2.8.3.</b>
                    
                    审计记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.8.4" data-path="../user-guide/platform-console/operation-mgmt/persistentevent.html">
            
                <a href="../user-guide/platform-console/operation-mgmt/persistentevent.html">
            
                    
                        <b>1.4.2.8.4.</b>
                    
                    事件持久化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../user-guide/business-console/">
            
                <a href="../user-guide/business-console/">
            
                    
                        <b>1.4.3.</b>
                    
                    业务管理控制台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="../user-guide/business-console/workload-mgmt/">
            
                <a href="../user-guide/business-console/workload-mgmt/">
            
                    
                        <b>1.4.3.1.</b>
                    
                    应用管理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1.1" data-path="../user-guide/business-console/workload-mgmt/namespace.html">
            
                <a href="../user-guide/business-console/workload-mgmt/namespace.html">
            
                    
                        <b>1.4.3.1.1.</b>
                    
                    命名空间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.2" data-path="../user-guide/business-console/workload-mgmt/workload/">
            
                <a href="../user-guide/business-console/workload-mgmt/workload/">
            
                    
                        <b>1.4.3.1.2.</b>
                    
                    工作负载
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1.2.1" data-path="../user-guide/business-console/workload-mgmt/workload/development.html">
            
                <a href="../user-guide/business-console/workload-mgmt/workload/development.html">
            
                    
                        <b>1.4.3.1.2.1.</b>
                    
                    Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.2.2" data-path="../user-guide/business-console/workload-mgmt/workload/statefulset.html">
            
                <a href="../user-guide/business-console/workload-mgmt/workload/statefulset.html">
            
                    
                        <b>1.4.3.1.2.2.</b>
                    
                    StatefulSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.2.3" data-path="../user-guide/business-console/workload-mgmt/workload/daomonset.html">
            
                <a href="../user-guide/business-console/workload-mgmt/workload/daomonset.html">
            
                    
                        <b>1.4.3.1.2.3.</b>
                    
                    DaomonSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.2.4" data-path="../user-guide/business-console/workload-mgmt/workload/job.html">
            
                <a href="../user-guide/business-console/workload-mgmt/workload/job.html">
            
                    
                        <b>1.4.3.1.2.4.</b>
                    
                    Job
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.2.5" data-path="../user-guide/business-console/workload-mgmt/workload/cronjob.html">
            
                <a href="../user-guide/business-console/workload-mgmt/workload/cronjob.html">
            
                    
                        <b>1.4.3.1.2.5.</b>
                    
                    CronJob
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.2.6" data-path="../user-guide/business-console/workload-mgmt/workload/tapp.html">
            
                <a href="../user-guide/business-console/workload-mgmt/workload/tapp.html">
            
                    
                        <b>1.4.3.1.2.6.</b>
                    
                    TApp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.2.7" data-path="../user-guide/business-console/workload-mgmt/workload/request-limits.html">
            
                <a href="../user-guide/business-console/workload-mgmt/workload/request-limits.html">
            
                    
                        <b>1.4.3.1.2.7.</b>
                    
                    工作负载的请求与限制
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.3" data-path="../user-guide/business-console/workload-mgmt/fu-wu/">
            
                <a href="../user-guide/business-console/workload-mgmt/fu-wu/">
            
                    
                        <b>1.4.3.1.3.</b>
                    
                    服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1.3.1" data-path="../user-guide/business-console/workload-mgmt/fu-wu/service.html">
            
                <a href="../user-guide/business-console/workload-mgmt/fu-wu/service.html">
            
                    
                        <b>1.4.3.1.3.1.</b>
                    
                    Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.3.2" data-path="../user-guide/business-console/workload-mgmt/fu-wu/ingress.html">
            
                <a href="../user-guide/business-console/workload-mgmt/fu-wu/ingress.html">
            
                    
                        <b>1.4.3.1.3.2.</b>
                    
                    Ingress
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.4" data-path="../user-guide/business-console/workload-mgmt/pei-zhi-guan-li/">
            
                <a href="../user-guide/business-console/workload-mgmt/pei-zhi-guan-li/">
            
                    
                        <b>1.4.3.1.4.</b>
                    
                    配置管理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1.4.1" data-path="../user-guide/business-console/workload-mgmt/pei-zhi-guan-li/configmap.html">
            
                <a href="../user-guide/business-console/workload-mgmt/pei-zhi-guan-li/configmap.html">
            
                    
                        <b>1.4.3.1.4.1.</b>
                    
                    ConfigMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.4.2" data-path="../user-guide/business-console/workload-mgmt/pei-zhi-guan-li/secret.html">
            
                <a href="../user-guide/business-console/workload-mgmt/pei-zhi-guan-li/secret.html">
            
                    
                        <b>1.4.3.1.4.2.</b>
                    
                    Sercet
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.5" data-path="../user-guide/business-console/workload-mgmt/cun-chu/">
            
                <a href="../user-guide/business-console/workload-mgmt/cun-chu/">
            
                    
                        <b>1.4.3.1.5.</b>
                    
                    存储
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1.5.1" data-path="../user-guide/business-console/workload-mgmt/cun-chu/pv-he-pvc.html">
            
                <a href="../user-guide/business-console/workload-mgmt/cun-chu/pv-he-pvc.html">
            
                    
                        <b>1.4.3.1.5.1.</b>
                    
                    PV和PVC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.5.2" data-path="../user-guide/business-console/workload-mgmt/cun-chu/storageclass.html">
            
                <a href="../user-guide/business-console/workload-mgmt/cun-chu/storageclass.html">
            
                    
                        <b>1.4.3.1.5.2.</b>
                    
                    StorageClass
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.6" data-path="../user-guide/business-console/workload-mgmt/shi-jian.html">
            
                <a href="../user-guide/business-console/workload-mgmt/shi-jian.html">
            
                    
                        <b>1.4.3.1.6.</b>
                    
                    事件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.1.7" data-path="../user-guide/business-console/workload-mgmt/ri-zhi.html">
            
                <a href="../user-guide/business-console/workload-mgmt/ri-zhi.html">
            
                    
                        <b>1.4.3.1.7.</b>
                    
                    日志
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3.2" data-path="../user-guide/business-console/business-mgmt.html">
            
                <a href="../user-guide/business-console/business-mgmt.html">
            
                    
                        <b>1.4.3.2.</b>
                    
                    业务管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.3" data-path="../user-guide/business-console/registry-mgmt/">
            
                <a href="../user-guide/business-console/registry-mgmt/">
            
                    
                        <b>1.4.3.3.</b>
                    
                    组织资源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.3.1" data-path="../user-guide/business-console/registry-mgmt/repo-mgmt.html">
            
                <a href="../user-guide/business-console/registry-mgmt/repo-mgmt.html">
            
                    
                        <b>1.4.3.3.1.</b>
                    
                    镜像仓库管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.3.2" data-path="../user-guide/business-console/registry-mgmt/helm-repo.html">
            
                <a href="../user-guide/business-console/registry-mgmt/helm-repo.html">
            
                    
                        <b>1.4.3.3.2.</b>
                    
                    Helm模板
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.3.3" data-path="../user-guide/business-console/registry-mgmt/apikey-mgmt.html">
            
                <a href="../user-guide/business-console/registry-mgmt/apikey-mgmt.html">
            
                    
                        <b>1.4.3.3.3.</b>
                    
                    访问凭证
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3.4" data-path="../user-guide/business-console/monitor-alert/">
            
                <a href="../user-guide/business-console/monitor-alert/">
            
                    
                        <b>1.4.3.4.</b>
                    
                    监控与告警
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.4.1" data-path="../user-guide/business-console/monitor-alert/alerts.html">
            
                <a href="../user-guide/business-console/monitor-alert/alerts.html">
            
                    
                        <b>1.4.3.4.1.</b>
                    
                    设置告警
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.4.2" data-path="../user-guide/business-console/monitor-alert/notifier.html">
            
                <a href="../user-guide/business-console/monitor-alert/notifier.html">
            
                    
                        <b>1.4.3.4.2.</b>
                    
                    通知设置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.3.5" data-path="../user-guide/business-console/operation-mgmt/">
            
                <a href="../user-guide/business-console/operation-mgmt/">
            
                    
                        <b>1.4.3.5.</b>
                    
                    运维中心
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.5.1" data-path="../user-guide/business-console/operation-mgmt/helm.html">
            
                <a href="../user-guide/business-console/operation-mgmt/helm.html">
            
                    
                        <b>1.4.3.5.1.</b>
                    
                    Helm应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.5.2" data-path="../user-guide/business-console/operation-mgmt/log-collection.html">
            
                <a href="../user-guide/business-console/operation-mgmt/log-collection.html">
            
                    
                        <b>1.4.3.5.2.</b>
                    
                    日志采集
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../key-features/">
            
                <a href="../key-features/">
            
                    
                        <b>1.5.</b>
                    
                    特色功能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../key-features/tapp.html">
            
                <a href="../key-features/tapp.html">
            
                    
                        <b>1.5.1.</b>
                    
                    TAPP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../key-features/galaxy.html">
            
                <a href="../key-features/galaxy.html">
            
                    
                        <b>1.5.2.</b>
                    
                    Galaxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../key-features/cronhpa.html">
            
                <a href="../key-features/cronhpa.html">
            
                    
                        <b>1.5.3.</b>
                    
                    CronHPA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../key-features/gpumanager.html">
            
                <a href="../key-features/gpumanager.html">
            
                    
                        <b>1.5.4.</b>
                    
                    GPU-Manager说明
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../key-features/lbcf.html">
            
                <a href="../key-features/lbcf.html">
            
                    
                        <b>1.5.5.</b>
                    
                    LBCF说明
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.6.</b>
                    
                    最佳实践
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="k8s-upgrade.html">
            
                <a href="k8s-upgrade.html">
            
                    
                        <b>1.6.1.</b>
                    
                    K8S 版本升级说明
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="custom-k8s-version-upgrade.html">
            
                <a href="custom-k8s-version-upgrade.html">
            
                    
                        <b>1.6.2.</b>
                    
                    自定义k8s版本升级
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.3" data-path="private-environment-install.html">
            
                <a href="private-environment-install.html">
            
                    
                        <b>1.6.3.</b>
                    
                    wx 私有化部署最佳实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="storage-practice.html">
            
                <a href="storage-practice.html">
            
                    
                        <b>1.6.4.</b>
                    
                    使用存储的实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="jenkins-cicd.html">
            
                <a href="jenkins-cicd.html">
            
                    
                        <b>1.6.5.</b>
                    
                    基于 Jenkins 的 CI/CD
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../develop/">
            
                <a href="../develop/">
            
                    
                        <b>1.7.</b>
                    
                    开发指引
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../develop/api.html">
            
                <a href="../develop/api.html">
            
                    
                        <b>1.7.1.</b>
                    
                    API 使用指引
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../faq/">
            
                <a href="../faq/">
            
                    
                        <b>1.8.</b>
                    
                    FAQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../faq/installation/">
            
                <a href="../faq/installation/">
            
                    
                        <b>1.8.1.</b>
                    
                    部署类
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="../faq/installation/frequently-answer.html">
            
                <a href="../faq/installation/frequently-answer.html">
            
                    
                        <b>1.8.1.1.</b>
                    
                    常见报错解决方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.2" data-path="../faq/installation/resource-plan.html">
            
                <a href="../faq/installation/resource-plan.html">
            
                    
                        <b>1.8.1.2.</b>
                    
                    如何规划部署资源
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../faq/platforms/">
            
                <a href="../faq/platforms/">
            
                    
                        <b>1.8.2.</b>
                    
                    平台类
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="../faq/platforms/metricsinfo.html">
            
                <a href="../faq/platforms/metricsinfo.html">
            
                    
                        <b>1.8.2.1.</b>
                    
                    监控告警指标列表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2" data-path="../faq/platforms/platform-questions.html">
            
                <a href="../faq/platforms/platform-questions.html">
            
                    
                        <b>1.8.2.2.</b>
                    
                    平台使用常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../faq/permission/">
            
                <a href="../faq/permission/">
            
                    
                        <b>1.8.3.</b>
                    
                    授权类
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.3.1" data-path="../faq/permission/ldap-oidc.html">
            
                <a href="../faq/permission/ldap-oidc.html">
            
                    
                        <b>1.8.3.1.</b>
                    
                    如何接入LDAP&OIDC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.2" data-path="../faq/permission/business-platform.html">
            
                <a href="../faq/permission/business-platform.html">
            
                    
                        <b>1.8.3.2.</b>
                    
                    业务管理、平台管理的区别
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.3" data-path="../faq/permission/custom-policy.html">
            
                <a href="../faq/permission/custom-policy.html">
            
                    
                        <b>1.8.3.3.</b>
                    
                    如何设置自定义策略
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.4" data-path="../faq/permission/dockerlogin-error.html">
            
                <a href="../faq/permission/dockerlogin-error.html">
            
                    
                        <b>1.8.3.4.</b>
                    
                    Docker login 权限错误
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../faq/events/">
            
                <a href="../faq/events/">
            
                    
                        <b>1.8.4.</b>
                    
                    事件类
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="../faq/events/frequently-event.html">
            
                <a href="../faq/events/frequently-event.html">
            
                    
                        <b>1.8.4.1.</b>
                    
                    常见错误事件
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../release/">
            
                <a href="../release/">
            
                    
                        <b>1.9.</b>
                    
                    Release Notes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../release/release1.5.html">
            
                <a href="../release/release1.5.html">
            
                    
                        <b>1.9.1.</b>
                    
                    1.5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../release/release1.4.html">
            
                <a href="../release/release1.4.html">
            
                    
                        <b>1.9.2.</b>
                    
                    1.4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../release/release1.3.html">
            
                <a href="../release/release1.3.html">
            
                    
                        <b>1.9.3.</b>
                    
                    1.3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >wx 私有化部署最佳实践</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="wx-&#x79C1;&#x6709;&#x5316;&#x90E8;&#x7F72;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;">wx &#x79C1;&#x6709;&#x5316;&#x90E8;&#x7F72;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;</h1>
<p>[TOC]</p>
<h2 id="wx-tkestack-&#x79C1;&#x6709;&#x5316;&#x90E8;&#x7F72;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;">wx tkestack &#x79C1;&#x6709;&#x5316;&#x90E8;&#x7F72;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;</h2>
<h3 id="&#x80CC;&#x666F;">&#x80CC;&#x666F;</h3>
<p>&#x968F;&#x7740;&#x79C1;&#x6709;&#x5316;&#x9879;&#x76EE;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x7B80;&#x5355;&#x5FEB;&#x6377;&#x90E8;&#x7F72;&#x4EA4;&#x4ED8;&#x9700;&#x6C42;&#x65E5;&#x76CA;&#x5F3A;&#x70C8;&#x3002;&#x5728;&#x5F00;&#x6E90;&#x534F;&#x540C;&#x5927;&#x884C;&#x5176;&#x9053;&#xFF0C;&#x79C1;&#x6709;&#x5316;&#x4E00;&#x952E;&#x90E8;&#x7F72;&#x5982;&#x4F55;&#x5408;&#x7406;&#x5229;&#x7528;&#x5F00;&#x6E90;&#x534F;&#x540C;&#x529B;&#x91CF;&#x505A;&#x5230;&#x7528;&#x597D;80%&#xFF0C;&#x505A;&#x597D;20% &#x503C;&#x5F97;&#x601D;&#x800C;&#x6DF1;&#x884C;&#x800C;&#x7B80;&#x3002;&#x672C;&#x6587;&#x5C06;&#x63ED;&#x79D8;&#x79C1;&#x6709;&#x5316;&#x4E00;&#x952E;&#x90E8;&#x7F72;&#x7ED3;&#x5408;tkestack &#x5B9E;&#x73B0;&#x79C1;&#x6709;&#x5316;&#x4E00;&#x952E;&#x90E8;&#x7F72;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x9762;&#x7EB1;&#x3002;</p>
<h3 id="&#x65B9;&#x6848;&#x9009;&#x578B;">&#x65B9;&#x6848;&#x9009;&#x578B;</h3>
<p>&#x867D;&#x7136;&#x5F00;&#x6E90;&#x534F;&#x540C;&#x5927;&#x884C;&#x5176;&#x9053;&#xFF0C;&#x4F46;<strong>&#x5408;&#x9002;&#x624D;&#x662F;&#x6700;&#x597D;</strong>&#x57FA;&#x672C;&#x539F;&#x5219;&#x4ECD;&#x7136;&#x9700;&#x8981;&#x8D2F;&#x5F7B;&#x6267;&#x884C; -- &#x91CF;&#x4F53;&#x88C1;&#x8863;&#xFF1B;&#x7ED3;&#x5408;&#x5F00;&#x53D1;&#x96BE;&#x5EA6;&#xFF0C;&#x5F00;&#x53D1;&#x6548;&#x7387;&#xFF0C;&#x540E;&#x671F;&#x4EE3;&#x7801;&#x7EF4;&#x62A4;&#xFF0C;&#x7EC4;&#x4EF6;&#x7EF4;&#x62A4;&#xFF0C;&#x5B9E;&#x65BD;&#x4EBA;&#x5458;&#x4F7F;&#x7528;&#x96BE;&#x5EA6;&#xFF0C;&#x5B9E;&#x65BD;&#x4EBA;&#x5458;&#x73B0;&#x573A;&#x4FEE;&#x6539;&#x96BE;&#x5EA6;&#x7B49;&#x591A;&#x7EF4;&#x5EA6;&#x8FDB;&#x884C;&#x8003;&#x91CF;&#x3002;&#x65B9;&#x6848;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li><strong>kubeadm+ansible:</strong>  **&#x4F18;&#x70B9;&#xFF1A;**&#x5BF9;kubernetes&#x7248;&#x672C;&#xFF0C;&#x7F51;&#x7EDC;&#x63D2;&#x4EF6;&#xFF0C;docker &#x7248;&#x672C;&#x81EA;&#x4E3B;&#x53EF;&#x63A7;&#xFF1B;  **&#x7F3A;&#x70B9;&#xFF1A;**&#x7EF4;&#x62A4;&#x6210;&#x672C;&#x9AD8;&#xFF0C;&#x7279;&#x522B;kubernetes&#x5347;&#x7EA7;,&#xFF0C;&#x65E0;&#x6CD5;&#x4E13;&#x6CE8;&#x4E8E;&#x4E1A;&#x52A1;&#x5C42;&#x9762;&#x7684;&#x4E00;&#x952E;&#x90E8;&#x7F72;;</li>
<li><strong>tkestack+ansible:</strong>  **&#x4F18;&#x70B9;&#xFF1A;**&#x5BF9;&#x4E8E;kubernetes&#x7684;&#x96C6;&#x6210;&#xFF0C;&#x7EF4;&#x62A4;&#x65E0;&#x9700;&#x5173;&#x5FC3;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x7528;&#x597D;tkestack&#x4E5F;&#x5C31;&#x638C;&#x63E1;tkestack&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;&#x505A;&#x597D;&#x5E94;&#x6025;&#xFF1B;&#x4E13;&#x6CE8;&#x4E8E;&#x4E1A;&#x52A1;&#x5C42;&#x9762;&#x7684;&#x4E00;&#x952E;&#x90E8;&#x7F72;&#x96C6;&#x6210;&#x5373;&#x53EF;&#x3002;&#x901A;&#x8FC7;ansible&#x8FDB;&#x884C;&#x673A;&#x5668;&#x6279;&#x91CF;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x90E8;&#x7F72;&#x65B9;&#x4FBF;&#x5FEB;&#x6377;&#x5BF9;&#x4E8E;&#x5B9E;&#x65BD;&#x4EBA;&#x5458;&#x8981;&#x6C42;&#x4F4E;&#xFF0C;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x73B0;&#x573A;&#x4FEE;&#x6539;;  <strong>&#x7F3A;&#x70B9;&#xFF1A;</strong> kubernetes &#x7248;&#x672C;&#xFF0C;&#x7F51;&#x7EDC;&#x63D2;&#x4EF6;&#xFF0C;docker &#x7248;&#x672C;&#x4E0D;&#x81EA;&#x4E3B;&#x53EF;&#x63A7;;</li>
<li><strong>tkestack+operator:</strong>  **&#x4F18;&#x70B9;&#xFF1A;**&#x79C1;&#x6709;&#x5316;&#x4E00;&#x952E;&#x90E8;&#x7F72;&#x4EA7;&#x54C1;&#x5316;&#xFF0C;&#x5E73;&#x53F0;&#x5316;&#xFF1B;  **&#x7F3A;&#x70B9;&#xFF1A;**operator&#x5F00;&#x53D1;&#x6210;&#x672C;&#x9AD8;&#xFF0C;&#x5BA2;&#x6237;&#x73AF;&#x5883;&#x591A;&#x53D8;&#x590D;&#x6742;&#xFF0C;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#x6CA1;&#x6CD5;&#x73B0;&#x573A;&#x4FEE;&#x6539;;</li>
</ul>
<p>&#x7EFC;&#x5408;&#x4E0A;&#x8FF0;&#x65B9;&#x6848;&#x8003;&#x8651;&#x7EF4;&#x62A4;kubernetes&#x6210;&#x672C;&#x6709;&#x70B9;&#x9AD8;&#xFF0C;&#x53E6;&#x5916;tkestack+ansible&#x901A;&#x8FC7;hooks&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x6269;&#x5C55;&#xFF0C;&#x80FD;&#x5B9E;&#x73B0;&#x5FEB;&#x901F;&#x96C6;&#x6210;&#xFF0C;&#x53EF;&#x4EE5;&#x4E13;&#x6CE8;&#x4E8E;&#x4E1A;&#x52A1;&#x7EC4;&#x4EF6;&#x96C6;&#x6210;&#x5373;&#x53EF;&#xFF1B;ansible &#x5165;&#x624B;&#x5BB9;&#x6613;&#xFF0C;&#x964D;&#x4F4E;&#x5B9E;&#x65BD;&#x4EBA;&#x5458;&#x5B66;&#x4E60;&#x6210;&#x672C;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x6839;&#x636E;&#x73B0;&#x573A;&#x73AF;&#x5883;&#x968F;&#x65F6;&#x4FEE;&#x6539;&#x9002;&#x914D;&#xFF1B;&#x7EFC;&#x5408;&#x8003;&#x91CF;&#x9009;&#x62E9;tkestack+ansible &#x6A21;&#x5F0F;&#x3002;</p>
<h3 id="&#x9700;&#x6C42;">&#x9700;&#x6C42;</h3>
<p><strong>&#x529F;&#x80FD;&#x6027;&#x9700;&#x6C42;&#xFF1A;</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">&#x529F;&#x80FD;</th>
<th style="text-align:left">&#x8BF4;&#x660E;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&#x4E3B;&#x673A;&#x521D;&#x59CB;&#x5316;</td>
<td style="text-align:left">&#x5B89;&#x88C5;&#x524D;&#x8FDB;&#x884C;&#x4E3B;&#x673A;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6BD4;&#x5982;&#x6DFB;&#x52A0;&#x57DF;&#x540D;hosts&#xFF0C;&#x5B89;&#x88C5;&#x538B;&#x6D4B;&#x5DE5;&#x5177;&#xFF0C;&#x79BB;&#x7EBF;yum&#x6E90;&#x7B49;</td>
</tr>
<tr>
<td style="text-align:left">&#x4E3B;&#x673A;&#x68C0;&#x67E5;</td>
<td style="text-align:left">&#x68C0;&#x67E5;&#x5F53;&#x524D;&#x4E3B;&#x673A;&#x7684;&#x6027;&#x80FD;&#x662F;&#x5426;&#x7B26;&#x5408;&#x9700;&#x6C42;&#xFF0C;&#x78C1;&#x76D8;&#x5927;&#x5C0F;&#x662F;&#x5426;&#x7B26;&#x5408;&#x9700;&#x6C42;,&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#xFF0C;&#x5185;&#x6838;&#x7248;&#x672C;&#xFF0C;&#x6027;&#x80FD;&#x538B;&#x6D4B;&#x7B49;</td>
</tr>
<tr>
<td style="text-align:left">tkestack&#x90E8;&#x7F72;</td>
<td style="text-align:left">&#x90E8;&#x7F72;kuberntes&#x548C;tkestack</td>
</tr>
<tr>
<td style="text-align:left">&#x4E1A;&#x52A1;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x90E8;&#x7F72;</td>
<td style="text-align:left">&#x90E8;&#x7F72;&#x4E1A;&#x52A1;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#xFF0C;&#x6BD4;&#x5982;redis&#xFF0C;mysql&#xFF0C;&#x90E8;&#x7F72;&#x8FD0;&#x7EF4;&#x7EC4;&#x4EF6;elk&#xFF0C;prometheus&#x7B49;</td>
</tr>
<tr>
<td style="text-align:left">&#x4E1A;&#x52A1;&#x90E8;&#x7F72;</td>
<td style="text-align:left">&#x90E8;&#x7F72;&#x4E1A;&#x52A1;&#x670D;&#x52A1;</td>
</tr>
</tbody>
</table>
<p><strong>&#x975E;&#x529F;&#x80FD;&#x6027;&#x9700;&#x6C42;&#xFF1A;</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">&#x529F;&#x80FD;</th>
<th style="text-align:left">&#x8BF4;&#x660E;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&#x89E3;&#x8026;</td>
<td style="text-align:left">&#x9488;&#x5BF9;&#x4E00;&#x4E9B;&#x5DF2;&#x6709;kubernetes/tke &#x5E73;&#x53F0;&#xFF0C;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x53EA;&#x90E8;&#x7F72;&#x4E1A;&#x52A1;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x53CA;&#x4E1A;&#x52A1;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x548C;tkestack&#x89E3;&#x8026;</td>
</tr>
<tr>
<td style="text-align:left">&#x6269;&#x5C55;&#x6027;</td>
<td style="text-align:left">&#x4E1A;&#x52A1;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#x4E0D;&#x540C;&#x9879;&#x76EE;&#x9700;&#x8981;&#x91C7;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#xFF0C;&#x9700;&#x8981;&#x5FEB;&#x6377;&#x96C6;&#x6210;&#x65B0;&#x7684;&#x7EC4;&#x4EF6;</td>
</tr>
<tr>
<td style="text-align:left">&#x5E42;&#x7B49;</td>
<td style="text-align:left">&#x90E8;&#x7F72;&#x53CA;&#x5378;&#x8F7D;&#x65F6;&#x53EF;&#x4EE5;&#x91CD;&#x590D;&#x6267;&#x884C;</td>
</tr>
</tbody>
</table>
<h3 id="&#x5B9E;&#x73B0;">&#x5B9E;&#x73B0;</h3>
<h4 id="1-&#x8D70;&#x8FDB;tkesack">1. &#x8D70;&#x8FDB;tkesack</h4>
<p>&#x4ECE;tkestack git &#x83B7;&#x53D6;&#x5230;&#x7684;&#x67B6;&#x6784;&#x56FE;&#x53EF;&#x4EE5;&#x770B;&#x51FA;tkestack&#x5206;&#x4E3A;installer&#xFF0C; Global&#xFF0C;cluster&#x8FD9;&#x4E09;&#x79CD;&#x89D2;&#x8272;&#xFF1B;&#x5176;&#x4E2D;installer &#x8D1F;&#x8D23;tkestack Global&#x96C6;&#x7FA4;&#x7684;&#x5B89;&#x88C5;&#xFF0C;&#x5F53;&#x524D;&#x63D0;&#x4F9B;&#x547D;&#x4EE4;&#x884C;&#x5B89;&#x88C5;&#x6A21;&#x5F0F;&#x548C;&#x56FE;&#x5F62;&#x5316;&#x5B89;&#x88C5;&#x6A21;&#x5F0F;&#xFF1B;cluster &#x89D2;&#x8272;&#x662F;&#x4F5C;&#x4E3A;&#x4E1A;&#x52A1;&#x96C6;&#x7FA4;&#xFF0C;&#x901A;Global&#x96C6;&#x7FA4;&#x7EB3;&#x7BA1;&#x3002;&#x5F53;&#x524D;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x90E8;&#x7F72;&#x4E00;&#x4E2A;Global&#x96C6;&#x7FA4;&#x4F5C;&#x4E3A;&#x4E1A;&#x52A1;&#x96C6;&#x7FA4;&#x5373;&#x53EF;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#xFF0C;cluster&#x96C6;&#x7FA4;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x7ED9;&#x5BA2;&#x6237;&#x4F7F;&#x7528;tkestack&#x591A;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x4F7F;&#x7528;&#x3002;</p>
<p>tkestack &#x5728;installer &#x4EE5;hooks &#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x6269;&#x5C55;&#xFF0C; &#x6709;&#x5982;&#x4E0B;hook&#x811A;&#x672C;&#xFF1A;</p>
<ul>
<li>pre-installer: &#x4E3B;&#x8981;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x524D;&#x7684;&#x4E00;&#x4E9B;&#x81EA;&#x5B9A;&#x4E49;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;</li>
<li>post-cluster-ready: &#x79CD;&#x5B50;&#x96C6;&#x7FA4;ready&#x540E;&#x9488;&#x5BF9;tkestack &#x90E8;&#x7F72;&#x524D;&#x7684;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;</li>
<li>post-install: tkestack &#x90E8;&#x7F72;&#x5B8C;&#x6BD5;&#xFF0C;&#x90E8;&#x7F72;&#x81EA;&#x5B9A;&#x4E49;&#x6269;&#x5C55;</li>
</ul>
<p>&#x9ED8;&#x8BA4;tkestack&#x90E8;&#x7F72;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#x7531;&#x4E8E;installer &#x8282;&#x70B9;&#x5728;tkestack &#x8BBE;&#x8BA1;&#x4E0A;&#x8BA1;&#x5212;&#x5B89;&#x88C5;&#x5B8C;&#x6BD5;&#x76F4;&#x63A5;&#x5E9F;&#x5F03;&#xFF0C;&#x6240;&#x4EE5;tkestack &#x4F1A;&#x5728;global&#x96C6;&#x7FA4;&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x4F5C;&#x4E3A;&#x540E;&#x7EED;&#x4E1A;&#x52A1;&#x4F7F;&#x7528;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x4F1A;&#x5C06;tkestack &#x5E73;&#x53F0;&#x7684;&#x955C;&#x50CF;&#x91CD;&#x65B0;repush&#x5230;&#x96C6;&#x7FA4;&#x5185;&#x7684;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x3002;&#x6240;&#x4EE5;&#x5BB9;&#x5668;&#x5316;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x6269;&#x5C55;&#x4E3B;&#x4EF6;&#x7684;&#x90E8;&#x7F72;&#x9700;&#x8981;&#x653E;&#x5230;post-install &#x811A;&#x672C;&#x8FDB;&#x884C;&#x89E6;&#x53D1;&#x3002;</p>
<h4 id="2-&#x9B54;&#x6539;&#x90E8;&#x7F72;&#x914D;&#x7F6E;">2. &#x9B54;&#x6539;&#x90E8;&#x7F72;&#x914D;&#x7F6E;</h4>
<ul>
<li>tkestack git &#x4F7F;&#x7528;&#x624B;&#x518C;&#x7ED9;&#x51FA;&#x4E86;&#x4E24;&#x79CD;&#x90E8;&#x7F72;&#x6A21;&#x5F0F;&#x4E00;&#x79CD;&#x662F;web&#x9875;&#x9762;&#x914D;&#x7F6E;&#x6A21;&#x5F0F;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x547D;&#x4EE4;&#x884C;&#x6A21;&#x5F0F;&#xFF1B;&#x7ECF;&#x8FC7;&#x4F7F;&#x7528;&#x53D1;&#x73B0;tkestack&#x6709;&#x4E2A;&#x4EAE;&#x70B9;&#x7279;&#x6027;&#x5C31;&#x662F;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8BB0;&#x5F55;&#x4E86;&#x4E00;&#x4E2A;step &#x5B89;&#x88C5;&#x6B65;&#x9AA4;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5B89;&#x88C5;&#x5931;&#x8D25;&#x540E;&#x89E3;&#x51B3;&#x95EE;&#x5931;&#x8D25;&#x539F;&#x56E0;&#x76F4;&#x63A5;&#x91CD;&#x542F;tke-installer &#x5373;&#x53EF;&#x6839;&#x636E;&#x5F53;&#x524D;step &#x6B65;&#x9AA4;&#x7EE7;&#x7EED;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#x90E8;&#x7F72;&#xFF1B;&#x6211;&#x4EEC;&#x5229;&#x7528;&#x8FD9;&#x7279;&#x6027;&#x5B9E;&#x73B0;web&#x9875;&#x9762;&#x914D;&#x7F6E;&#x6A21;&#x5F0F;&#x4E5F;&#x53EF;&#x4EE5;&#x547D;&#x4EE4;&#x884C;&#x6A21;&#x5F0F;&#x90E8;&#x7F72;&#x3002;&#x5177;&#x4F53;&#x64CD;&#x4F5C;&#x662F;&#x5148;&#x901A;&#x8FC7;&#x9875;&#x9762;&#x914D;&#x7F6E;&#x5F97;&#x5230;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x628A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x505A;&#x6210;&#x6A21;&#x677F;; &#x90E8;&#x7F72;&#x65F6;&#x5019;&#x901A;&#x8FC7;ansible templet &#x6A21;&#x5757;&#x8FDB;&#x884C;&#x6E32;&#x67D3;&#x3002; &#x5F53;&#x524D;&#x62BD;&#x53D6;&#x51FA;&#x6765;&#x914D;&#x7F6E;&#x6A21;&#x677F;&#x6709;:</li>
<li>tke-ha-lb.json.j2 &#x5BF9;&#x5E94;web&#x9875;&#x9762;&#x7684;&#x4F7F;&#x7528;&#x5DF2;&#x6709;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x91C7;&#x7528;&#x8D1F;&#x8F7D;&#x5747;&#x8861;ip&#x5730;&#x5740;&#x4F5C;&#x4E3A;tkestack&#x96C6;&#x7FA4;&#x9AD8;&#x53EF;&#x7528;</li>
<li>tke-ha-keepalived.json.j2 &#x5BF9;&#x5E94;web&#x9875;&#x9762;&#x7684;TKE&#x63D0;&#x4F9B;&#xFF0C;&#x91C7;&#x7528;vip&#x901A;&#x8FC7;keepalived &#x6D6E;&#x52A8;&#x6F02;&#x79FB;&#x5B9E;&#x73B0;&#x9AD8;&#x53EF;&#x7528;</li>
<li>tke-sigle.json.j2 &#x5BF9;&#x5E94;web&#x9875;&#x9762;&#x7684;&#x4E0D;&#x8BBE;&#x7F6E;&#x573A;&#x666F;&#xFF0C; &#x4E5F;&#x5C31;&#x662F;&#x5355;master&#x7248;&#x573A;&#x666F; &#x4EE5;&#x4E0B;&#x4EE5;tke-ha-lb.json.j2 &#x4E3A;&#x4F8B;&#xFF1A;</li>
</ul>
<pre><code class="lang-text">{
&quot;config&quot;: {
&quot;ServerName&quot;: &quot;tke-installer&quot;,
&quot;ListenAddr&quot;: &quot;:8080&quot;,
&quot;NoUI&quot;: false,
&quot;Config&quot;: &quot;conf/tke.json&quot;,
&quot;Force&quot;: false,
&quot;SyncProjectsWithNamespaces&quot;: false,
&quot;Replicas&quot;: {{ tke_replicas }}
},
&quot;para&quot;: {
&quot;cluster&quot;: {
 &quot;kind&quot;: &quot;Cluster&quot;,
 &quot;apiVersion&quot;: &quot;platform.tkestack.io/v1&quot;,
 &quot;metadata&quot;: {
  &quot;name&quot;: &quot;global&quot;
 },
 &quot;spec&quot;: {
  &quot;finalizers&quot;: [
   &quot;cluster&quot;
  ],
  &quot;tenantID&quot;: &quot;default&quot;,
  &quot;displayName&quot;: &quot;TKE&quot;,
  &quot;type&quot;: &quot;Baremetal&quot;,
  &quot;version&quot;: &quot;{{ k8s_version }}&quot;,
  &quot;networkDevice&quot;: &quot;{{ net_interface }}&quot;,
  &quot;clusterCIDR&quot;: &quot;{{ cluster_cidr }}&quot;,
  &quot;dnsDomain&quot;: &quot;cluster.local&quot;,
  &quot;features&quot;: {
   &quot;ipvs&quot;: {{ ipvs }},
   &quot;enableMasterSchedule&quot;: true,
   &quot;ha&quot;: {
    &quot;thirdParty&quot;: {
     &quot;vip&quot;: &quot;{{ tke_vip }}&quot;,
     &quot;vport&quot;: {{ tke_vport}}
    }
   }
  },
  &quot;properties&quot;: {
   &quot;maxClusterServiceNum&quot;: {{ max_cluster_service_num }},
   &quot;maxNodePodNum&quot;: {{ max_node_pod_num }}
  },
  &quot;machines&quot;: [
    {
     &quot;ip&quot;: &quot;{{ groups[&apos;masters&apos;][0] }}&quot;,
     &quot;port&quot;: {{ ansible_port }},
     &quot;username&quot;: &quot;{{ ansible_ssh_user }}&quot;,
     &quot;password&quot;: &quot;{{ ansible_ssh_pass_base64 }}&quot;
    },
    {
     &quot;ip&quot;: &quot;{{ groups[&apos;masters&apos;][1] }}&quot;,
     &quot;port&quot;: {{ ansible_port }},
     &quot;username&quot;: &quot;{{ ansible_ssh_user }}&quot;,
     &quot;password&quot;: &quot;{{ ansible_ssh_pass_base64 }}&quot;
    },
    {
      &quot;ip&quot;: &quot;{{ groups[&apos;masters&apos;][2] }}&quot;,
      &quot;port&quot;: {{ ansible_port }},
      &quot;username&quot;: &quot;{{ ansible_ssh_user }}&quot;,
      &quot;password&quot;: &quot;{{ ansible_ssh_pass_base64 }}&quot;
    }
  ],
  &quot;dockerExtraArgs&quot;: {
   &quot;data-root&quot;: &quot;{{ docker_data_root }}&quot;
  },
  &quot;kubeletExtraArgs&quot;: {
   &quot;root-dir&quot;: &quot;{{ kubelet_root_dir }}&quot;
  },
  &quot;apiServerExtraArgs&quot;: {
   &quot;runtime-config&quot;: &quot;apps/v1beta1=true,apps/v1beta2=true,extensions/v1beta1/daemonsets=true,extensions/v1beta1/deployments=true,extensions/v1beta1/replicasets=true,extensions/v1beta1/networkpolicies=true,extensions/v1beta1/podsecuritypolicies=true&quot;
  }
 }
},
&quot;Config&quot;: {
 &quot;basic&quot;: {
  &quot;username&quot;: &quot;{{ tke_admin_user }}&quot;,
  &quot;password&quot;: &quot;{{ tke_pwd_base64 }}&quot;
 },
 &quot;auth&quot;: {
  &quot;tke&quot;: {
   &quot;tenantID&quot;: &quot;default&quot;,
   &quot;username&quot;: &quot;{{ tke_admin_user }}&quot;,
   &quot;password&quot;: &quot;{{ tke_pwd_base64 }}&quot;
  }
 },
 &quot;registry&quot;: {
  &quot;tke&quot;: {
   &quot;domain&quot;: &quot;{{ tke_registry_domain }}&quot;,
   &quot;namespace&quot;: &quot;library&quot;,
   &quot;username&quot;: &quot;{{ tke_admin_user }}&quot;,
   &quot;password&quot;: &quot;{{ tke_pwd_base64 }}&quot;
  }
 },
 &quot;business&quot;: {},
 &quot;monitor&quot;: {
  &quot;influxDB&quot;: {
   &quot;local&quot;: {}
  }
 },
 &quot;ha&quot;: {
  &quot;thirdParty&quot;: {
    &quot;vip&quot;: &quot;{{ tke_vip }}&quot;,
    &quot;vport&quot;: {{ tke_vport}}
  }
 },
 &quot;gateway&quot;: {
  &quot;domain&quot;: &quot;{{ tke_console_domain }}&quot;,
  &quot;cert&quot;: {
   &quot;selfSigned&quot;: {}
  }
 }
}
},
&quot;cluster&quot;: {
&quot;kind&quot;: &quot;Cluster&quot;,
&quot;apiVersion&quot;: &quot;platform.tkestack.io/v1&quot;,
&quot;metadata&quot;: {
 &quot;name&quot;: &quot;global&quot;
},
&quot;spec&quot;: {
 &quot;finalizers&quot;: [
  &quot;cluster&quot;
 ],
 &quot;tenantID&quot;: &quot;default&quot;,
 &quot;displayName&quot;: &quot;TKE&quot;,
 &quot;type&quot;: &quot;Baremetal&quot;,
 &quot;version&quot;: &quot;{{ k8s_version }}&quot;,
 &quot;networkDevice&quot;: &quot;{{ net_interface }}&quot;,
 &quot;clusterCIDR&quot;: &quot;{{ cluster_cidr }}&quot;,
 &quot;dnsDomain&quot;: &quot;cluster.local&quot;,
 &quot;features&quot;: {
  &quot;ipvs&quot;: {{ ipvs }},
  &quot;enableMasterSchedule&quot;: true,
  &quot;ha&quot;: {
   &quot;thirdParty&quot;: {
     &quot;vip&quot;: &quot;{{ tke_vip }}&quot;,
     &quot;vport&quot;: {{ tke_vport}}
   }
  }
 },
 &quot;properties&quot;: {
  &quot;maxClusterServiceNum&quot;: {{ max_cluster_service_num }},
  &quot;maxNodePodNum&quot;: {{ max_node_pod_num }}
 },
 &quot;machines&quot;: [
   {
     &quot;ip&quot;: &quot;{{ groups[&apos;masters&apos;][0] }}&quot;,
     &quot;port&quot;: {{ ansible_port }},
     &quot;username&quot;: &quot;{{ ansible_ssh_user }}&quot;,
     &quot;password&quot;: &quot;{{ ansible_ssh_pass_base64 }}&quot;
   },
   {
     &quot;ip&quot;: &quot;{{ groups[&apos;masters&apos;][1] }}&quot;,
     &quot;port&quot;: {{ ansible_port }},
     &quot;username&quot;: &quot;{{ ansible_ssh_user }}&quot;,
     &quot;password&quot;: &quot;{{ ansible_ssh_pass_base64 }}&quot;
   },
   {
     &quot;ip&quot;: &quot;{{ groups[&apos;masters&apos;][2] }}&quot;,
     &quot;port&quot;: {{ ansible_port }},
     &quot;username&quot;: &quot;{{ ansible_ssh_user }}&quot;,
     &quot;password&quot;: &quot;{{ ansible_ssh_pass_base64 }}&quot;
   }
 ],
 &quot;dockerExtraArgs&quot;: {
  &quot;data-root&quot;: &quot;{{ docker_data_root }}&quot;
 },
 &quot;kubeletExtraArgs&quot;: {
  &quot;root-dir&quot;: &quot;{{ kubelet_root_dir }}&quot;
 },
 &quot;apiServerExtraArgs&quot;: {
  &quot;runtime-config&quot;: &quot;apps/v1beta1=true,apps/v1beta2=true,extensions/v1beta1/daemonsets=true,extensions/v1beta1/deployments=true,extensions/v1beta1/replicasets=true,extensions/v1beta1/networkpolicies=true,extensions/v1beta1/podsecuritypolicies=true&quot;
 }
}
},
&quot;step&quot;: 0 # &#x91CD;&#x542F;tke-installer &#x540E;&#x4F1A;&#x6309;&#x6B64;&#x6B65;&#x9AA4;&#x6267;&#x884C;&#x7EE7;&#x7EED;&#x7684;&#x5B89;&#x88C5;&#xFF0C;&#x5F53;&#x524D;&#x8BBE;&#x7F6E;&#x4E3A;0&#x610F;&#x5473;&#x7740;&#x4ECE;&#x96F6;&#x5F00;&#x59CB;
}
</code></pre>
<p>&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x6B64;&#x65B9;&#x5F0F;&#x5B89;&#x88C5;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x5B89;&#x88C5;&#x811A;&#x672C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-text">#!/bin/bash
# Author: yhchen
set -e

BASE_DIR=$(cd `dirname $0` &amp;&amp; pwd)
cd $BASE_DIR

# get offline-pot parent dir
OFFLINE_POT_PDIR=`echo ${BASE_DIR} | awk -Foffline-pot &apos;{print $1}&apos;`

INSTALL_DIR=/opt/tke-installer
DATA_DIR=${INSTALL_DIR}/data
HOOKS=${OFFLINE_POT_PDIR}offline-pot
IMAGES_DIR=&quot;${OFFLINE_POT_PDIR}offline-pot-images&quot;
TGZ_DIR=&quot;${OFFLINE_POT_PDIR}offline-pot-tgz&quot;
REPORTS_DIR=&quot;${OFFLINE_POT_PDIR}perfor-reports&quot;
version=v1.2.4

init_tke_installer(){
  if [ `docker images | grep tke-installer | grep ${version} | wc -l` -eq 0 ]; then
    if [ `docker ps -a | grep tke-installer | wc -l` -gt 0 ]; then
      docker rm -f tke-installer
    fi
    if [ `docker images | grep tke-installer | wc -l` -gt 0 ]; then
      docker rmi -f `docker images | grep tke-installer | awk &apos;{print $3}&apos;`
    fi 
    cd ${OFFLINE_POT_PDIR}tkestack
    if [ -d &quot;${OFFLINE_POT_PDIR}tkestack/tke-installer-x86_64-${version}.run.tmp&quot; ]; then
      rm -rf ${OFFLINE_POT_PDIR}tkestack/tke-installer-x86_64-${version}.run.tmp
    fi
    sha256sum --check --status tke-installer-x86_64-$version.run.sha256 &amp;&amp; \
    chmod +x tke-installer-x86_64-$version.run &amp;&amp; ./tke-installer-x86_64-$version.run
  fi
}

reinstall_tke_installer(){
  if [ -d &quot;${REPORTS_DIR}&quot; ]; then
    mkdir -p ${REPORTS_DIR}
  fi
  if [ `docker ps -a | grep tke-installer | wc -l` -eq 1 ]; then
    docker rm -f tke-installer
    rm -rf /opt/tke-installer/data
  fi
  docker run --restart=always --name tke-installer -d --privileged --net=host -v/etc/hosts:/app/hosts \
  -v/etc/docker:/etc/docker -v/var/run/docker.sock:/var/run/docker.sock -v$DATA_DIR:/app/data \
  -v$INSTALL_DIR/conf:/app/conf -v$HOOKS:/app/hooks -v$IMAGES_DIR:${IMAGES_DIR} -v${TGZ_DIR}:${TGZ_DIR} \
  -v${REPORTS_DIR}:${REPORTS_DIR} tkestack/tke-installer:$version
  if [ -f &quot;hosts&quot; ]; then
    # set hosts file&apos;s dpl_dir variable
    sed -i &apos;s#^dpl_dir=.*#dpl_dir=\&quot;&apos;&quot;${HOOKS}&quot;&apos;\&quot;#g&apos; hosts
    installer_ip=`cat hosts | grep -A 1 &apos;\[installer\]&apos; | grep -v installer`
    echo &quot;please exec install-offline-pot.sh or access http://${installer_ip}:8080 to install offline-pot&quot;
  fi
}

main(){
  init_tke_installer # &#x6B64;&#x51FD;&#x6570;&#x662F;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x5C1A;&#x672A;&#x5B89;&#x88C5;&#x8FC7;tke-installer, &#x8FDB;&#x884C;&#x7B2C;&#x4E00;&#x6B21;&#x5B89;&#x88C5;&#x5B9E;&#x73B0;&#x521D;&#x59CB;&#x5316;
  reinstall_tke_installer # &#x6B64;&#x51FD;&#x6570;&#x662F;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x5B89;&#x88C5;tke-installer, &#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x5C06;&#x6269;&#x5C55;&#x7684;hooks&#x811A;&#x672C;&#x6302;&#x8F7D;&#x5230;tke-installer&#xFF0C;&#x4EE5;&#x53CA;hooks&#x811A;&#x672C;&#x8C03;&#x7528;&#x5230;&#x7684;&#x6574;&#x4E2A;&#x4E00;&#x952E;&#x90E8;&#x7F72;&#x811A;&#x672C;&#x3002;
}
main
</code></pre>
<p>&#x6700;&#x7EC8;&#x5B9E;&#x73B0;&#x5F00;&#x59CB;&#x90E8;&#x7F72;tkestack&#x811A;&#x672C;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-text">#!/bin/bash
# Author: yhchen
set -e

BASE_DIR=$(cd `dirname $0` &amp;&amp; pwd)
cd $BASE_DIR

CALL_FUN=&quot;defaut&quot;

help(){
  echo &quot;show usage:&quot;
  echo &quot;init_and_check: will be init hosts, inistall tke-installer and hosts check&quot;
  echo &quot;dpl_offline_pot: init tke config and deploy offline-pot&quot;
  echo &quot;init_keepalived: just tmp use, when tkestack fix keepalived issue will be remove&quot;
  echo &quot;only_install_tkestack: if you want only install tkestack, please -f parameter pass only_install_tkestack&quot;
  echo &quot;defualt: will be exec dpl_offline_pot and init_keepalived&quot;
  echo &quot;all_func: execute init_and_check, dpl_offline_pot, init_keepalived&quot;
  exit 0
}

while getopts &quot;:f:h:&quot; opt
do
  case $opt in
    f)
    CALL_FUN=&quot;${OPTARG}&quot;
    ;;
    h)
    hosts=&quot;${OPTARG}&quot;
    ;;
    ?)
    echo &quot;unkown args! just suport -f[call function] and -h[ansible hosts group] arg!!!&quot;
    exit 0;;
  esac
done

INSTALL_DATA_DIR=/opt/tke-installer/data/

init_and_check(){
  sh ./init-and-check.sh
}

# init tke config and deploy offline-pot
dpl_offline_pot(){
  echo &quot;###### deploy offline-pot start ######&quot;
  if [ `docker ps | grep tke-installer | wc -l` -eq 1 ]; then
    # deploy tkestack , base commons and business
    sh ./offline-pot-cmd.sh -s init-tke-config.sh -f init
    docker restart tke-installer
    if [ -f &quot;hosts&quot; ]; then
      installer_ip=`cat hosts | grep -A 1 &apos;\[installer\]&apos; | grep -v installer`
      echo &quot;please exec tail -f ${INSTALL_DATA_DIR}/tke.log or access http://${installer_ip}:8080 check install progress...&quot;
    fi
  elif [ ! -d &quot;../tkestack&quot; ]; then
    # deploy base commons and business on other kubernetes plat
    sh ./post-install
  else
    echo &quot;if first install,please exec init-and-check.sh script, else exec reinstall-offline-pot.sh script&quot; &amp;&amp; exit 0
  fi
  echo &quot;###### deploy offline-pot end ######&quot;
}

# just tmp use, when tkestack fix keepalived issue will be remove
init_keepalived(){
  echo &quot;###### init keepalived start  ######&quot;
  if [ -f &quot;${INSTALL_DATA_DIR}/tke.json&quot; ]; then
    if [ `cat ${INSTALL_DATA_DIR}/tke.json | grep -i &apos;&quot;ha&quot;&apos; | wc -l` -gt 0 ]; then
      nohup sh ./init_keepalived.sh 2&gt;&amp;1 &gt; ${INSTALL_DATA_DIR}/dpl-keepalived.log &amp;
    fi
  fi
  echo &quot;###### init keepalived end ######&quot;
}

# only install tkestack
only_install_tkestack(){
  echo &quot;###### install tkestack start ######&quot;
  # change tke components&apos;s replicas number
  if [ -f &quot;hosts&quot; ]; then 
    sed -i &apos;s/tke_replicas=&quot;1&quot;/tke_replicas=&quot;2&quot;/g&apos; hosts
  fi
  # hosts init
  if [ `docker ps | grep tke-installer | wc -l` -eq 1 ]; then
    sh ./offline-pot-cmd.sh -s host-init.sh -f sshd_init
    sh ./offline-pot-cmd.sh -s host-init.sh -f selinux_init
    sh ./offline-pot-cmd.sh -s host-init.sh -f remove_devnet_proxy
    sh ./offline-pot-cmd.sh -s host-init.sh -f add_domains
    sh ./offline-pot-cmd.sh -s host-init.sh -f data_disk_init
    sh ./offline-pot-cmd.sh -s host-init.sh -f check_iptables
  else
    echo &quot;please exec install-tke-installer.sh to start tke-installer&quot; &amp;&amp; exit 0
  fi
  # start install tkestack
  dpl_offline_pot
  init_keepalived
  echo &quot;###### install tkestack end ######&quot;
}

defaut(){
  # change tke components&apos;s replicas number
  if [ -f &quot;hosts&quot; ]; then 
    sed -i &apos;s/tke_replicas=&quot;2&quot;/tke_replicas=&quot;1&quot;/g&apos; hosts
  fi
  # only deploy tkestack
  if [ -d &apos;../tkestack&apos; ] &amp;&amp; [ ! -d &quot;../offline-pot-images&quot; ] &amp;&amp; [ ! -d &quot;../offline-pot-tgz&quot; ]; then
    only_install_tkestack
  fi
  dpl_offline_pot
  # when deploy tkestack will be init keepalived config
  if [ -d &apos;../tkestack&apos; ]; then
    init_keepalived
  fi
}

all_func(){
  # change tke components&apos;s replicas number
  if [ -f &quot;hosts&quot; ]; then 
    sed -i &apos;s/tke_replicas=&quot;2&quot;/tke_replicas=&quot;1&quot;/g&apos; hosts
  fi
  init_and_check
  defaut
}

main(){
  $CALL_FUN || help
}
main
</code></pre>
<p>&#x6B64;&#x811A;&#x672C;&#x4E3B;&#x8981;&#x662F;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x90E8;&#x7F72;&#x662F;&#x5426;&#x9700;&#x8981;&#x90E8;&#x7F72;tkestack&#x6216;&#x8005;&#x662F;&#x5426;&#x5355;&#x72EC;&#x90E8;&#x7F72;tkestack&#xFF0C;&#x82E5;&#x662F;&#x90E8;&#x7F72;tkestack&#x5219;&#x751F;&#x6210;tkestack &#x6240;&#x9700;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;,&#x7136;&#x540E;&#x901A;&#x8FC7;docker restart tke-installer &#x5373;&#x53EF;&#x51FA;&#x53D1;tkestack&#x90E8;&#x7F72;&#x4EE5;&#x53CA;&#x4E1A;&#x52A1;&#x4F9D;&#x8D56;&#x7EC4;&#x4EF6;&#xFF0C;&#x4E1A;&#x52A1;&#x90E8;&#x7F72;&#x3002;</p>
<ul>
<li>&#x6DFB;&#x52A0;worker&#x8282;&#x70B9;</li>
<li><p>&#x589E;&#x52A0;&#x81EA;&#x5B9A;&#x4E49;&#x53C2;&#x6570;&#x4F7F;&#x96C6;&#x7FA4;&#x66F4;&#x7A33;&#xFF0C;&#x66F4;&#x5F3A;&#x3002;&#x4E3B;&#x8981;&#x589E;&#x52A0;&#x81EA;&#x5B9A;&#x4E49;&#x53C2;&#x6570;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-text">1. dockerExtraArgs data-root &#x5236;&#x5B9A;docker &#x76EE;&#x5F55;&#x5230;&#x6570;&#x636E;&#x76D8;&#xFF0C;&#x907F;&#x514D;&#x7CFB;&#x7EDF;&#x76D8;&#x592A;&#x5C0F;&#x5BFC;&#x81F4;&#x8282;&#x70B9;&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x7387;&#x5F88;&#x5FEB;&#x5230;&#x8FBE;&#x8282;&#x70B9;&#x538B;&#x529B;&#x9608;&#x503C;&#x4EE5;&#x81F3;&#x4E8E;&#x8282;&#x70B9;&#x5904;&#x4E8E;not ready&#x72B6;&#x6001;
2. kubeletExtraArgs kubelete&#x81EA;&#x5B9A;&#x4E49;&#x53C2;&#x6570; root-dir &#x548C;docker data-root &#x53C2;&#x6570;&#x4F5C;&#x7528;&#x4E00;&#x81F4;
3. kubeletExtraArgs  kube-apiserver runtime-config apps/v1beta1=true,apps/v1beta2=true,extensions/v1beta1/daemonsets=true,extensions/v1beta1/deployments=true,extensions/v1beta1/replicasets=true,extensions/v1beta1/networkpolicies=true,extensions/v1beta1/podsecuritypolicies=true &#x589E;&#x52A0;&#x5DE5;&#x4F5C;&#x8D1F;&#x8F7D;deployment
</code></pre>
</li>
</ul>
<p>&#xFF0C;statefulset&#x7684;api version&#x517C;&#x5BB9;&#x6027;</p>
<pre><code class="lang-text">```
</code></pre>
<p>&#x5F53;&#x524D;&#x901A;&#x8FC7;ansible set facts &#x65B9;&#x5F0F;&#xFF0C;ansible when &#x6761;&#x4EF6;&#x6267;&#x884C;&#xFF0C;&#x4EE5;&#x53CA;shell &#x547D;&#x4EE4;&#x589E;&#x52A0;&#x5224;&#x65AD;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x5E42;&#x7B49;&#xFF1B;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x5F00;&#x5173;+hooks+ansible tag&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x6269;&#x5C55;&#x6027;&#x548C;&#x89E3;&#x8026;&#x3002;<br> &#x6700;&#x7EC8;&#x79C1;&#x6709;&#x5316;&#x4E00;&#x952E;&#x90E8;&#x7F72;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<h4 id="3-&#x4E1A;&#x52A1;&#x5E94;&#x7528;">3. &#x4E1A;&#x52A1;&#x5E94;&#x7528;</h4>
<p> &#x4E1A;&#x52A1;&#x901A;&#x8FC7;helmfile release&#xFF08;release&#x540D;&#x79F0;&#x5FC5;&#x987B;&#x4EE5;${&#x4E2D;&#x5FC3;&#x540D;}-${&#x5BA2;&#x6237;&#x540D;&#x7B80;&#x79F0;}&#xFF09;&#x6765;&#x7EC4;&#x7EC7;&#x4E0D;&#x540C;&#x5BA2;&#x6237;&#x90E8;&#x7F72;&#x4E0D;&#x540C;&#x7684;&#x4E1A;&#x52A1;&#x7EC4;&#x4EF6;&#xFF0C;&#x4E0D;&#x540C;release&#x5BF9;&#x5E94;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x4E1A;&#x52A1;&#x7EC4;&#x4EF6;&#x7684;helm chart value&#xFF0C;&#x5F53;&#x6253;&#x5305;&#x4E1A;&#x52A1;helm&#x65F6;&#x4F1A;&#x6839;&#x636E;release ${&#x4E2D;&#x5FC3;&#x540D;}-${&#x5BA2;&#x6237;&#x540D;&#x7B80;&#x79F0;}.yaml&#x6587;&#x4EF6;&#x5B9A;&#x4E49;&#x7684;&#x4E1A;&#x52A1;&#x7EC4;&#x4EF6;&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;&#x6253;&#x5305;&#xFF0C;&#x5B8C;&#x6210;&#x4E1A;&#x52A1;&#x6309;&#x9700;&#x90E8;&#x7F72;&#x3002;  </p>
<p> &#x79C1;&#x6709;&#x5316;&#x4E00;&#x952E;&#x90E8;&#x7F72;&#x65F6;&#x4F1A;&#x901A;&#x8FC7;helmfile &#x5DE5;&#x5177;&#x8FDB;&#x884C;&#x90E8;&#x7F72;&#xFF0C;&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#x3002;  </p>
<p> &#x66F4;&#x65B0;&#x8FC7;&#x7A0B;&#x79C1;&#x6709;&#x5316;&#x4E00;&#x952E;&#x90E8;&#x7F72;&#x5F53;&#x524D;&#x4E0D;&#x7EB3;&#x5165;&#x7BA1;&#x63A7;&#xFF0C;&#x53EA;&#x8D1F;&#x8D23;&#x5C06; agent &#x90E8;&#x7F72;&#x5230;master1 &#x8282;&#x70B9;&#x4F5C;&#x4E3A;cicd&#x6267;&#x884C;&#x66F4;&#x65B0;agent&#xFF0C;&#x5177;&#x4F53;&#x6D41;&#x7A0B;&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#x3002;</p>
<p>&#x5408;&#x7406;&#x5229;&#x7528;tkestack&#x7279;&#x6027;&#xFF08;&#x7528;&#x597D;80%&#xFF09;&#xFF0C;&#x7ED3;&#x5408;&#x81EA;&#x8EAB;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x505A;&#x51FA;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#x79C1;&#x6709;&#x5316;&#x4E00;&#x952E;&#x90E8;&#x7F72;(&#x505A;&#x597D;20%)&#x3002;</p>
<h3 id="&#x4E0D;&#x8DB3;">&#x4E0D;&#x8DB3;</h3>
<ul>
<li>&#x5F53;&#x524D;&#x6240;&#x6709;&#x955C;&#x50CF;&#x90FD;&#x662F;&#x6253;&#x6210;tar&#x9644;&#x4EF6;&#x6A21;&#x5F0F;&#x6253;&#x5305;&#x5B89;&#x88C5;&#x5305;&#xFF0C;&#x4F7F;&#x5F97;&#x5B89;&#x88C5;&#x5305;&#x6709;&#x70B9;&#x5927;&#xFF1B;&#x540C;&#x65F6;&#x90E8;&#x7F72;&#x96C6;&#x7FA4;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x65F6;&#x8FD8;&#x9700;&#x8981;&#x4ECE;installer&#x8282;&#x70B9;&#x7684;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x91CD;&#x65B0;&#x5C06;&#x955C;&#x50CF;&#x63A8;&#x9001;&#x81F3;&#x96C6;&#x7FA4;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#xFF0C;&#x8FD9;&#x4E2A;&#x8017;&#x65F6;&#x5F88;&#x5927;&#xFF1B;&#x5EFA;&#x8BAE;&#x5C06;&#x51FA;&#x5305;&#x65F6;&#x5C06;&#x955C;&#x50CF;&#x63A8;&#x9001;&#x5230;&#x79BB;&#x7EBF;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x79BB;&#x7EBF;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x6301;&#x4E45;&#x5316;&#x76EE;&#x5F55;&#x6253;&#x5305;&#x8FD9;&#x6837;&#x5408;&#x7406;&#x5229;&#x7528;&#x955C;&#x50CF;&#x7279;&#x6027;&#x7F29;&#x51CF;&#x5B89;&#x88C5;&#x5305;&#x5927;&#x5C0F;&#xFF1B;&#x90E8;&#x7F72;&#x65F6;&#x62F7;&#x8D1D;&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x6301;&#x4E45;&#x5316;&#x6570;&#x636E;&#x5230;&#x5BF9;&#x5E94;&#x76EE;&#x5F55;&#x5E76;&#x6302;&#x8F7D;&#xFF0C;&#x52A0;&#x901F;&#x90E8;&#x7F72;&#x3002;</li>
</ul>
<footer class="page-footer"><span class="copyright">TKEStack 2020 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x7AE0;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2020-12-23 16:37:59
</span></footer><script>document.addEventListener("DOMContentLoaded", function() {lightbox.option({"resizeDuration":200,"wrapAround":true});})</script>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="custom-k8s-version-upgrade.html" class="navigation navigation-prev " aria-label="Previous page: 自定义k8s版本升级">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="storage-practice.html" class="navigation navigation-next " aria-label="Next page: 使用存储的实践">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"wx 私有化部署最佳实践","level":"1.6.3","depth":2,"next":{"title":"使用存储的实践","level":"1.6.4","depth":2,"path":"best-practice/storage-practice.md","ref":"best-practice/storage-practice.md","articles":[]},"previous":{"title":"自定义k8s版本升级","level":"1.6.2","depth":2,"path":"best-practice/custom-k8s-version-upgrade.md","ref":"best-practice/custom-k8s-version-upgrade.md","articles":[]},"dir":"ltr"},"config":{"plugins":["back-to-top-button","hide-element","expandable-chapters-small","code","-lunr","-search","search-pro","tbfed-pagefooter","-sharing","sharing-plus","insert-logo","lightbox","github"],"root":"docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"TKEStack 2020","modify_label":"该文章修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"github":{"url":"https://github.com/tkestack/tke"},"search-pro":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"lightbox":{"jquery":true,"options":{"resizeDuration":200,"wrapAround":true},"sameUuid":false},"back-to-top-button":{},"expandable-chapters-small":{},"sharing":{"qq":false,"all":["douban","facebook","google","instapaper","linkedin","twitter","weibo","messenger","qq","qzone","viber","whatsapp"],"douban":false,"facebook":false,"weibo":false,"twitter":false,"pocket":false,"google":false,"qzone":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"insert-logo":{"style":"background: none; max-height: 30px; min-height: 30px","url":"https://avatars0.githubusercontent.com/u/57258287?s=200&v=4"}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"best-practice/private-environment-install.md","mtime":"2020-12-23T08:37:59.331Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-12-23T08:41:24.897Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-insert-logo/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lightbox/js/lightbox.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

